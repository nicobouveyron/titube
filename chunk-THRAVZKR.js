import{a as H}from"./chunk-STMGKB2A.js";import{a as L}from"./chunk-WC3RP3ZD.js";import{a as U}from"./chunk-RHUNEFEG.js";import{a as j,c as Q}from"./chunk-PVOPH7PJ.js";import"./chunk-ITMSBQFM.js";import{Ab as k,Fa as A,Ia as r,Mb as E,Sa as M,Wb as B,Ya as C,Yb as D,_a as m,bb as u,cb as g,da as h,e as q,f as V,fb as P,ga as v,gb as T,hb as a,ib as o,jb as _,kb as S,mb as y,nb as d,pa as f,qa as x,qb as F,rb as G,sb as O,tb as z,vb as s,wa as R,wb as b,xb as w,zb as I}from"./chunk-XBKZSOMQ.js";var l=q(H());var $=(t,c)=>c.index;function Y(t,c){if(t&1&&(a(0,"li",5),s(1),o()),t&2){let e=c.$implicit;r(),w(" ",e.rule," ")}}var W=(()=>{class t{constructor(){this.letter="R",this.title="Pouvoir : Roi du regard",this.card=R.required(),this.rules=E(()=>this.card().rules.map((e,i)=>({index:i,rule:e}))),this.backgrounds=["bg-[#73B4BD]","bg-[#E6BF25]","bg-[#A8C521]","bg-[#996AC1]"],this.texts=["text-[#73B4BD]","text-[#E6BF25]","text-[#A8C521]","text-[#996AC1]"],this.borders=["border-[#73B4BD]","border-[#E6BF25]","border-[#A8C521]","border-[#996AC1]"]}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["app-card-verso"]],inputs:{letter:"letter",title:"title",card:[1,"card"]},standalone:!0,features:[I],decls:12,vars:11,consts:[[1,"flex","items-center","justify-center","w-full","h-full","bg-white","rounded-3xl","relative","overflow-hidden","p-4","shadow-lg","border-4"],[1,"absolute","top-4","left-4","w-16","h-16","rounded-lg","flex","items-center","justify-center","z-20"],[1,"text-white","text-4xl","font-bold"],[1,"absolute","right-4","top-5","text-9xl","font-bold","opacity-20","z-20"],[1,"text-3xl","text-center","font-bold","leading-tight"],[1,"text-center","text-xl","leading-tight"]],template:function(i,n){i&1&&(a(0,"div",0)(1,"div",1)(2,"span",2),s(3),o()(),a(4,"div",3),s(5),o(),a(6,"div")(7,"h2",4),s(8),o(),a(9,"ul"),P(10,Y,2,1,"li",5,$),o()()()),i&2&&(u(n.borders[n.card().theme||0]),r(),u(n.backgrounds[n.card().theme||0]),r(2),b(n.card().value),r(),u(n.texts[n.card().theme||0]),r(),w(" ",n.card().value," "),r(2),u(n.texts[n.card().theme||0]),r(),w(" ",n.card().title," "),r(2),T(n.rules()))},dependencies:[D],styles:["[_nghost-%COMP%]{max-width:350pt}"]})}}return t})();var J=["riveCanvas"],K=t=>({"rotate-y-180":t}),X=t=>({"opacity-0":t}),Z=t=>({invisible:t});function ee(t,c){if(t&1&&(a(0,"h2",2),s(1," Au tour de "),a(2,"span",11),s(3),o()()),t&2){let e=d(2);r(3),b(e.game().player)}}function te(t,c){if(t&1&&_(0,"img",7),t&2){let e=d(2);F("src","titetes/",e.card.rive,"",A)}}function ie(t,c){if(t&1){let e=S();C(0,ee,4,1,"h2",2),a(1,"div",3),y("click",function(){f(e);let n=d();return x(n.isVerso.set(!n.isVerso()))}),a(2,"div",4)(3,"div",5)(4,"app-card",6),C(5,te,1,2,"img",7),_(6,"canvas",8,0),o()(),a(8,"div",9),_(9,"app-card-verso",6),o()()(),a(10,"button",10),y("click",function(){f(e);let n=d();return x(n.changeAnimation())}),s(11," Au suivant "),o()}if(t&2){let e=d();g(e.game().player?0:-1),r(2),m("ngClass",k(7,K,e.isVerso())),r(),m("ngClass",k(9,X,e.isVerso())),r(),m("card",e.card),r(),g(e.game().isRive?-1:5),r(),m("ngClass",k(11,Z,!e.game().isRive)),r(3),m("card",e.card)}}function ne(t,c){if(t&1){let e=S();a(0,"h2",2),s(1,"La partie est finie"),o(),a(2,"button",12),y("click",function(){f(e);let n=d();return x(n.changeAnimation())}),s(3," Relancer une partie "),o()}}var ge=(()=>{class t{constructor(){this.#e=h(Q),this.#t=h(L),this.#i=h(j),this.card=this.#e.card(),this.isVerso=M(!1),this.game=E(()=>(this.card=this.#e.card(),this.card&&this.loadRiveAnimation(this.card.rive),{out:this.#e.cardsOut(),deck:this.#e.cards(),player:this.#e.currentPlayer(),card:this.#e.card(),isRive:!this.card?.rive.endsWith(".png")})),this.riveUrl="le_titube.riv",this.riveInstance=null}#e;#t;#i;ngOnInit(){window.addEventListener("resize",this.onResize.bind(this))}ngAfterViewInit(){this.initRenderer(),this.loadRiveAnimation()}ngOnDestroy(){window.removeEventListener("resize",this.onResize.bind(this))}initRenderer(){if(this.canvas)try{let e=this.canvas.nativeElement;e.width=e.offsetWidth,e.height=e.offsetHeight;let i=new l.Layout({fit:l.Fit.Contain,alignment:l.Alignment.Center});this.riveInstance=new l.Rive({canvas:e,src:this.riveUrl,autoplay:!0,artboard:"lesTitous",layout:i,onLoad:()=>{}})}catch(e){console.error("Erreur lors du chargement de l'animation Rive:",e)}}loadRiveAnimation(e){return V(this,null,function*(){this.riveInstance&&(this.riveInstance.play(e),this.riveInstance.resizeToCanvas(),this.riveInstance.resizeDrawingSurfaceToCanvas(5))})}onResize(){if(this.riveInstance?.stop(),this.canvas&&this.riveInstance){let e=this.canvas.nativeElement,i=e.parentElement;i&&(e.width=i.clientWidth,e.height=i.clientHeight,this.loadRiveAnimation())}}changeAnimation(){this.#e.cards().length===0&&this.#e.reset(),this.isVerso.set(!1);let e=this.#i.getNextCardIndex(),i=this.#t.usernames(),n=this.#e.currentPlayer(),p=0;n&&(p=(i.indexOf(n)+1)%i.length),this.#e.addCarteOut(this.#e.cards()[e]),this.#e.setCurrentPlayer(i[p]),this.riveInstance&&this.game().isRive&&console.log({riveCard:this.card?.rive,riveInstance:this.riveInstance.contents})}static{this.\u0275fac=function(i){return new(i||t)}}static{this.\u0275cmp=v({type:t,selectors:[["app-game"]],viewQuery:function(i,n){if(i&1&&G(J,5),i&2){let p;O(p=z())&&(n.canvas=p.first)}},standalone:!0,features:[I],decls:3,vars:1,consts:[["riveCanvas",""],[1,"flex","flex-col","justify-center","items-center","h-full"],[1,"text-4xl","font-bold"],[1,"relative","w-[80%]","h-full","perspective",3,"click"],[1,"relative","w-full","h-full","duration-700","preserve-3d",3,"ngClass"],[1,"absolute","w-full","h-full","backface-hidden","duration-300",3,"ngClass"],[1,"block","w-full","h-full",3,"card"],[1,"absolute","top-0","bottom-0","left-0","right-0","m-auto",3,"src"],["id","riveCanvas",3,"ngClass"],[1,"absolute","w-full","h-full","backface-hidden","rotate-y-180"],["routerLink","/lobby",1,"rounded-lg","py-2","px-4","h-[70pt]","bg-orange-500","w-[80%]","text-white","text-3xl","my-5",3,"click"],[1,"text-[#FA7B53]","font-bold"],[1,"rounded-lg","py-2","px-4","h-[70pt]","bg-orange-500","w-[80%]","text-white","text-3xl","my-5",3,"click"]],template:function(i,n){i&1&&(a(0,"div",1),C(1,ie,12,13)(2,ne,4,0),o()),i&2&&(r(),g(n.card?1:2))},dependencies:[U,W,B],styles:["canvas[_ngcontent-%COMP%]{width:100%;height:100%}.perspective[_ngcontent-%COMP%]{perspective:1000px}.preserve-3d[_ngcontent-%COMP%]{transform-style:preserve-3d}.backface-hidden[_ngcontent-%COMP%]{backface-visibility:hidden;justify-content:center;display:flex}.rotate-y-180[_ngcontent-%COMP%]{transform:rotateY(180deg)}"]})}}return t})();export{ge as GameComponent};
